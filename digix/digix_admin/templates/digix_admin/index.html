{% extends 'digix_admin/base.html' %}
{% load static %}

{% block title %}Admin Home{% endblock %}

{% block priority_css_links %}
<style>
.custom-shadow {
  box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3); /* Modify these values as needed */
  border-radius: 10px;
}
</style>

{% endblock %}

{% block body %}
   

<div class="content-wrapper" id="content_wrapper_div">
  <div class="row d-flex justify-content-between">
    <div class=" d-flex justify-content-center align-items-center p-2 m-2  custom-shadow" style="width:20%;">
      <div>
        <div class="d-flex">
          <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-cart4 text-success" viewBox="0 0 16 16">
            <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5zM3.14 5l.5 2H5V5H3.14zM6 5v2h2V5H6zm3 0v2h2V5H9zm3 0v2h1.36l.5-2H12zm1.11 3H12v2h.61l.5-2zM11 8H9v2h2V8zM8 8H6v2h2V8zM5 8H3.89l.5 2H5V8zm0 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
          </svg> 
          <p class="fw-normal display-5 mx-3">Orders</p>
        </div>
        

        
          <p class="fw-normal fs-1 text-center">
                     
            
            {{total_orders}}</p>
        </div>
      </div>
      <div class=" d-flex justify-content-center align-items-center p-2 m-2  custom-shadow" style="width:20%;">
        <div>
          <div class="d-flex">
            <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-receipt text-primary" viewBox="0 0 16 16">
              <path d="M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27zm.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0l-.509-.51z"/>
              <path d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"/>
            </svg>
            <p class="fw-normal display-5 mx-3">Sales</p>
          </div>
          
  
          
            <p class="fw-normal fs-1 text-center">
                       
              
              {{total_sales}}</p>
          </div>
        </div>
        <div class=" d-flex justify-content-center align-items-center p-2 m-2  custom-shadow" style="width:20%;border:2px solid green;">
          <div>
            <div class="d-flex">
              <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-currency-rupee text-dark " viewBox="0 0 16 16">
                <path d="M4 3.06h2.726c1.22 0 2.12.575 2.325 1.724H4v1.051h5.051C8.855 7.001 8 7.558 6.788 7.558H4v1.317L8.437 14h2.11L6.095 8.884h.855c2.316-.018 3.465-1.476 3.688-3.049H12V4.784h-1.345c-.08-.778-.357-1.335-.793-1.732H12V2H4v1.06Z"/>
              </svg>
              <p class="fw-normal display-5 mx-3">Profit</p>
            </div>
            
    
            
              <p class="fw-normal fs-1 text-center">
                         
                
               Rs {{total_profit}}</p>
            </div>
          </div>
          <div class=" d-flex justify-content-center align-items-center p-2 m-2  custom-shadow" style="width:20%;">
            <div>
              <div class="d-flex">
                <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-people-fill text-info" viewBox="0 0 16 16">
                  <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7Zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm-5.784 6A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216ZM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"/>
                </svg>
                <p class="fw-normal display-5 mx-3">Users</p>
              </div>
              
      
              
                <p class="fw-normal fs-1 text-center">
                           
                  
                  {{total_users}}</p>
              </div>
            </div>
            <div class=" d-flex justify-content-center align-items-center p-2 m-2  custom-shadow" style="width:20%;">
              <div>
                <div class="d-flex">
                  <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-exclamation-diamond-fill text-warning" viewBox="0 0 16 16">
                    <path d="M9.05.435c-.58-.58-1.52-.58-2.1 0L.436 6.95c-.58.58-.58 1.519 0 2.098l6.516 6.516c.58.58 1.519.58 2.098 0l6.516-6.516c.58-.58.58-1.519 0-2.098L9.05.435zM8 4c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995A.905.905 0 0 1 8 4zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                  </svg>
                  <p class="fw-normal display-5 mx-3">Cancelled</p>
                </div>
                
        
                
                  <p class="fw-normal fs-1 text-center">
                             
                    
                    {{total_cancelled}}</p>
                </div>
              </div>

              <div class=" d-flex justify-content-center align-items-center p-2 m-2  custom-shadow" style="width:20%;">
                <div>
                  <div class="d-flex">
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-sign-turn-slight-left-fill text-danger" viewBox="0 0 16 16">
                      <path d="M9.05.435c-.58-.58-1.52-.58-2.1 0L.436 6.95c-.58.58-.58 1.519 0 2.098l6.516 6.516c.58.58 1.519.58 2.098 0l6.516-6.516c.58-.58.58-1.519 0-2.098L9.05.435ZM6.864 8.368a.25.25 0 0 1-.451-.039l-1.06-2.882a.25.25 0 0 1 .192-.333l3.026-.523a.25.25 0 0 1 .26.371l-.667 1.154.621.373A2.5 2.5 0 0 1 10 8.632V11H9V8.632a1.5 1.5 0 0 0-.728-1.286l-.607-.364-.8 1.386Z"/>
                    </svg>
                    <p class="fw-normal display-5 mx-3">Returns</p>
                  </div>
                  
          
                  
                    <p class="fw-normal fs-1 text-center">
                               
                      
                      {{total_returned}}</p>
                  </div>
                </div>
                <div class=" d-flex justify-content-center align-items-center p-2 m-2  custom-shadow" style="width:20%;">
                  <div>
                    <div class="d-flex">
                      <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-currency-euro text-success" viewBox="0 0 16 16">
                        <path d="M4 9.42h1.063C5.4 12.323 7.317 14 10.34 14c.622 0 1.167-.068 1.659-.185v-1.3c-.484.119-1.045.17-1.659.17-2.1 0-3.455-1.198-3.775-3.264h4.017v-.928H6.497v-.936c0-.11 0-.219.008-.329h4.078v-.927H6.618c.388-1.898 1.719-2.985 3.723-2.985.614 0 1.175.05 1.659.177V2.194A6.617 6.617 0 0 0 10.341 2c-2.928 0-4.82 1.569-5.244 4.3H4v.928h1.01v1.265H4v.928z"/>
                      </svg>
                      <p class="fw-normal display-5 mx-3">Orders Today</p>
                    </div>
                    
            
                    
                      <p class="fw-normal fs-1 text-center">
                                 
                        
                        {{daily_orders_count}}</p>
                    </div>
                  </div>
                  <div class=" d-flex justify-content-center align-items-center p-2 m-2  custom-shadow" style="width:20%;">
                    <div>
                      <div class="d-flex">
                        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-currency-euro text-success" viewBox="0 0 16 16">
                          <path d="M4 9.42h1.063C5.4 12.323 7.317 14 10.34 14c.622 0 1.167-.068 1.659-.185v-1.3c-.484.119-1.045.17-1.659.17-2.1 0-3.455-1.198-3.775-3.264h4.017v-.928H6.497v-.936c0-.11 0-.219.008-.329h4.078v-.927H6.618c.388-1.898 1.719-2.985 3.723-2.985.614 0 1.175.05 1.659.177V2.194A6.617 6.617 0 0 0 10.341 2c-2.928 0-4.82 1.569-5.244 4.3H4v.928h1.01v1.265H4v.928z"/>
                        </svg>
                        <p class="fw-normal display-5 mx-3">Total Profit Today</p>
                      </div>
                      
              
                      
                        <p class="fw-normal fs-1 text-center">
                                   
                          
                          Rs {% if daily_sales_amount is not None %} {{daily_sales_amount}} {% else %} 0 {% endif %}</p>
                      </div>
                    </div>
    
  </div>

  <div class="row d-flex justify-content-center">
    
  </div>

  <div class="row mt-5">
    <div class="col-6" style="height: 300px">
      <canvas id="myChart1"></canvas>
    </div>
    <div class="col-6" style="height: 300px">
      <canvas id="myChart2"></canvas>
    </div>
    <div class="col-6" style="height: 300px">
      <canvas id="myChart3"></canvas>
    </div>
  </div>
  
  
  

  <div class="row mt-5">
    <p class="fw-normal fs-4">Sales Report</p>
    <div class="col-12 mt-3">
      <form class="bg-light p-2" style="border:2px solid black;border-radius:15px;" method="get" action="{% url 'digix_admin:download_report' %}">
        <div class="d-flex justify-content-between mt-2">
          <div class="d-flex e mx-2">
            <select class="form-select" aria-label="Default select example" name="month">
             
                <option selected>Select Month</option>
                <option value="1">Januvary</option>
                <option value="2">Februavary</option>
                <option value="3">March</option>
                
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
             
            </select>
          </div>
          <div class="d-flex">
            <div class="form-group d-flex align-items-center">
              <label for="exampleInputEmail1" class="fw-bold" style="width:122px;">Start Date</label>
              <input type="date" class="form-control bg-light text-dark mx-3" id="exampleInputEmail1" aria-describedby="emailHelp" name="start_date">
            </div>
            <div class="form-group d-flex align-items-center">
              <label for="exampleInputEmail1" class="fw-bold" style="width:122px;">End Date</label>
              <input type="date" class="form-control bg-light text-dark mx-3" id="exampleInputEmail1" aria-describedby="emailHelp" name="end_date">
            </div>
            <div class="form-group d-flex align-items-center">
              <label for="year" class="fw-bold" style="width:122px;">Year</label>
              <select class="form-select" id="year" name="year">
                <!-- JavaScript will populate this dynamically -->
              </select>
            </div>
          </div>
          <div>
            <button type="submit" class="btn btn-dark">Submit</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  
  <div class="row">
    <div class="col-12 mt-3 text-center" >
      {% if messages %}
                                            <div class="  text-center w-100 mt-1">
                                                {% for message in messages %}
                                                <p class="text-danger">{{ message }}</p>
                                                {% endfor %}
                                            </div>
                                            {% endif %}
    </div>
  </div>
</div>


{% endblock %}

{% block priority_js_links %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
function createChart1(order_array) {
  const labels = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

  const data = {
    labels: labels,
    datasets: [{
      label: 'Day orders',
      data: order_array,
      backgroundColor: [
        'rgba(255, 99, 132, 0.2)',
        'rgba(255, 159, 64, 0.2)',
        'rgba(255, 205, 86, 0.2)',
        'rgba(75, 192, 192, 0.2)',
        'rgba(54, 162, 235, 0.2)',
        'rgba(153, 102, 255, 0.2)',
        'rgba(201, 203, 207, 0.2)'
      ],
      borderColor: [
        'rgb(255, 99, 132)',
        'rgb(255, 159, 64)',
        'rgb(255, 205, 86)',
        'rgb(75, 192, 192)',
        'rgb(54, 162, 235)',
        'rgb(153, 102, 255)',
        'rgb(201, 203, 207)'
      ],
      borderWidth: 1
    }]
  };

  const ctx = document.getElementById('myChart1');

  new Chart(ctx, {
    type: 'bar',
    data: data,
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
}

function createChart2(order_array) {
  const labels = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

  const data = {
    labels: labels,
    datasets: [{
      label: 'Dataset',
      data: order_array,
      borderColor: 'rgb(75, 192, 192)',
      backgroundColor: 'rgba(75, 192, 192, 0.2)',
      pointStyle: 'circle',
      pointRadius: 10,
      pointHoverRadius: 15
    }]
  };

  const ctx = document.getElementById('myChart2');

  new Chart(ctx, {
    type: 'line',
    data: data,
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: (ctx) => 'Day order: ' + ctx.chart.data.datasets[0].pointStyle,
        }
      }
    }
  });
}
function createChart3() {
  // Fetch data from the backend
  fetch('/admin/chart_order_status/')
    .then(response => response.json())
    .then(chartData => {
      console.log(chartData.datasets);
      // Access data and labels from chartData object
      const data = chartData.datasets[0]['data'];
      const labels = chartData['labels'];

      const ctx = document.getElementById('myChart3');
      const chart3 = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [
            {
              data: data,
              backgroundColor: chartData.datasets[0]['backgroundColor'],
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Order Status',
            },
          },
        },
      });
    })
    .catch(error => console.log(error));
}

// Call the createChart3 function to create the doughnut chart
createChart3();

// Call the function when you have the order_array data
fetch('/admin/get_order_data/')
  .then(response => response.json())
  .then(response => {
    const order_array = response.order_data;
    createChart1(order_array);
    createChart2(order_array);
  })
  .catch(error => console.log(error));
</script>



<script>
  // JavaScript to populate the year select element with the current year, previous year, and next year
  var yearSelect = document.getElementById("year");
  var currentYear = new Date().getFullYear();

  for (var i = currentYear - 1; i <= currentYear + 1; i++) {
    var option = document.createElement("option");
    option.value = i;
    option.text = i;
    yearSelect.appendChild(option);
  }
</script>


{% endblock %}